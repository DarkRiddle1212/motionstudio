import{r as e,j as t}from"./chunk-CJk5566G.js";import{A as a,F as r,M as l,a as n,S as i}from"./chunk-6oSn1JRi.js";import{D as s}from"./chunk-B2YaEX5v.js";import"./chunk-BXbIpaFw.js";const o=()=>t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),c=()=>t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),d=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),m=({status:e})=>t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${{completed:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800",refunded:"bg-purple-100 text-purple-800"}[e]||"bg-gray-100 text-gray-800"}`,children:e.charAt(0).toUpperCase()+e.slice(1)}),h=({data:e,loading:a})=>{var r,l;if(a)return t.jsx("div",{className:"h-64 flex items-center justify-center",children:t.jsx("div",{className:"animate-pulse text-gray-400",children:"Loading chart..."})});if(0===e.length)return t.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No revenue data available for this period"});const n=Math.max(...e.map(e=>e.revenue),1);return t.jsxs("div",{className:"h-64",children:[t.jsx("div",{className:"flex items-end justify-between h-full gap-1",children:e.map((e,a)=>t.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[t.jsx("div",{className:"w-full bg-blue-500 rounded-t hover:bg-blue-600 transition-colors cursor-pointer",style:{height:e.revenue/n*100+"%",minHeight:e.revenue>0?"4px":"0"}}),t.jsx("div",{className:"absolute bottom-full mb-2 hidden group-hover:block z-10",children:t.jsxs("div",{className:"bg-gray-900 text-white text-xs rounded py-1 px-2 whitespace-nowrap",children:[t.jsx("div",{className:"font-medium",children:e.date}),t.jsxs("div",{children:["$",e.revenue.toLocaleString()]}),t.jsxs("div",{children:[e.transactions," transactions"]})]})})]},a))}),t.jsxs("div",{className:"flex justify-between mt-2 text-xs text-gray-500",children:[t.jsx("span",{children:null==(r=e[0])?void 0:r.date}),t.jsx("span",{children:null==(l=e[e.length-1])?void 0:l.date})]})]})},u=({payment:a,onClose:r,onConfirm:l,loading:n})=>{const[i,s]=e.useState("");return a?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Process Refund"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Transaction ID"}),t.jsx("p",{className:"font-medium",children:a.transactionId})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Amount"}),t.jsxs("p",{className:"font-medium",children:["$",a.amount.toFixed(2)," ",a.currency]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Student"}),t.jsx("p",{className:"font-medium",children:a.student.email})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Course"}),t.jsx("p",{className:"font-medium",children:a.course.title})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Refund Reason"}),t.jsx("textarea",{value:i,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"Enter reason for refund..."})]}),t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-yellow-800",children:[t.jsx("strong",{children:"Warning:"})," This will revoke the student's access to the course."]})})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:n,children:"Cancel"}),t.jsx("button",{onClick:()=>l(i),className:"px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",disabled:n,children:n?"Processing...":"Process Refund"})]})]})}):null},g=({payment:e,onClose:a,onRefund:r})=>e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4 p-6",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Details"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-gray-600",children:"Status"}),t.jsx(m,{status:e.status})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Transaction Info"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:"Transaction ID"}),t.jsx("p",{className:"font-mono text-xs break-all",children:e.transactionId})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:"Amount"}),t.jsxs("p",{className:"font-medium",children:["$",e.amount.toFixed(2)," ",e.currency]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:"Provider"}),t.jsx("p",{children:e.paymentProvider})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500",children:"Date"}),t.jsx("p",{children:new Date(e.createdAt).toLocaleString()})]})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Student"}),t.jsxs("div",{className:"text-sm",children:[t.jsxs("p",{children:[e.student.firstName," ",e.student.lastName]}),t.jsx("p",{className:"text-gray-500",children:e.student.email})]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Course"}),t.jsx("p",{className:"text-sm",children:e.course.title})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"}),"completed"===e.status&&t.jsx("button",{onClick:r,className:"px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors",children:"Process Refund"})]})]})}):null,p=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[p,x]=e.useState(null),[y,b]=e.useState([]),[v,f]=e.useState([]),[N,w]=e.useState(!0),[C,k]=e.useState(!1),[j,$]=e.useState(!1),[R,D]=e.useState(null),[A,B]=e.useState(1),[S,L]=e.useState(10),[M,E]=e.useState(0),[P,T]=e.useState(""),[F,U]=e.useState({}),[z,I]=e.useState(null),[O,W]=e.useState(!1),[V,_]=e.useState(!1),[H,q]=e.useState(!1),[J,K]=e.useState(30),G=()=>localStorage.getItem("adminToken"),X=e.useCallback(async()=>{try{const e=G(),t=await fetch(`/api/admin/financial/metrics?period=${J}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch metrics");const a=await t.json();x(a)}catch(e){D(e.message)}},[J]),Q=e.useCallback(async()=>{$(!0);try{const e=G(),t=J<=7||J<=30?"day":"week",a=await fetch(`/api/admin/financial/revenue-chart?period=${J}&groupBy=${t}`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Failed to fetch chart data");const r=await a.json();f(r.chartData)}catch(e){}finally{$(!1)}},[J]),Y=e.useCallback(async()=>{k(!0);try{const e=G(),t=new URLSearchParams({page:A.toString(),pageSize:S.toString()});if(P&&t.append("search",P),F.status&&t.append("status",F.status),F.dateRange){const e=F.dateRange;e.start&&t.append("startDate",e.start),e.end&&t.append("endDate",e.end)}if(F.amountRange){const e=F.amountRange;null!==e.min&&t.append("minAmount",e.min.toString()),null!==e.max&&t.append("maxAmount",e.max.toString())}const a=await fetch(`/api/admin/financial/payments?${t}`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Failed to fetch payments");const r=await a.json();b(r.payments),E(r.pagination.totalItems)}catch(e){D(e.message)}finally{k(!1)}},[A,S,P,F]),Z=async e=>{try{const t=G(),a=new URLSearchParams({format:e});if(F.dateRange){const e=F.dateRange;e.start&&a.append("startDate",e.start),e.end&&a.append("endDate",e.end)}const r=await fetch(`/api/admin/financial/export?${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error("Failed to export report");if("csv"===e){const e=await r.blob(),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`financial-report-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}else{const e=await r.json(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`financial-report-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a)}}catch(t){alert(t.message)}};e.useEffect(()=>{(async()=>{w(!0),await Promise.all([X(),Q(),Y()]),w(!1)})()},[X,Q,Y]);const ee=[{id:"transactionId",header:"Transaction ID",accessor:"transactionId",render:e=>t.jsxs("span",{className:"font-mono text-xs",children:[e.substring(0,20),"..."]})},{id:"student",header:"Student",accessor:e=>e.student.email,render:(e,a)=>t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",children:[a.student.firstName," ",a.student.lastName]}),t.jsx("p",{className:"text-xs text-gray-500",children:a.student.email})]})},{id:"course",header:"Course",accessor:e=>e.course.title,hiddenOnMobile:!0},{id:"amount",header:"Amount",accessor:"amount",sortable:!0,align:"right",render:(e,a)=>t.jsxs("span",{className:"font-medium",children:["$",e.toFixed(2)," ",a.currency]})},{id:"status",header:"Status",accessor:"status",render:e=>t.jsx(m,{status:e})},{id:"createdAt",header:"Date",accessor:"createdAt",sortable:!0,hiddenOnMobile:!0,render:e=>new Date(e).toLocaleDateString()},{id:"actions",header:"Actions",accessor:"id",align:"center",render:(e,a)=>t.jsxs("div",{className:"flex gap-2 justify-center",children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),I(a),W(!0)},className:"text-blue-600 hover:text-blue-800 text-sm",children:"View"}),"completed"===a.status&&t.jsx("button",{onClick:e=>{e.stopPropagation(),I(a),_(!0)},className:"text-red-600 hover:text-red-800 text-sm",children:"Refund"})]})}],te={page:A,pageSize:S,totalItems:M,onPageChange:B,onPageSizeChange:L,pageSizeOptions:[10,25,50,100]};return N?t.jsx(a,{title:"Financial Dashboard",children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):R?t.jsx(a,{title:"Financial Dashboard",children:t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:["Error: ",R]})}):t.jsxs(a,{title:"Financial Dashboard",children:[t.jsx(r,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Financial Overview"}),t.jsx("p",{className:"text-gray-600",children:"Monitor revenue, transactions, and payment activity"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("select",{value:J,onChange:e=>K(Number(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:7,children:"Last 7 days"}),t.jsx("option",{value:30,children:"Last 30 days"}),t.jsx("option",{value:90,children:"Last 90 days"}),t.jsx("option",{value:365,children:"Last year"})]}),t.jsxs("div",{className:"relative group",children:[t.jsxs("button",{className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(d,{}),t.jsx("span",{className:"ml-2",children:"Export"})]}),t.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden group-hover:block z-10",children:[t.jsx("button",{onClick:()=>Z("csv"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Export as CSV"}),t.jsx("button",{onClick:()=>Z("json"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"Export as JSON"})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(l,{title:"Total Revenue",value:`$${(null==p?void 0:p.totalRevenue.toLocaleString())||0}`,icon:n.Revenue,iconBgColor:"bg-green-100",iconColor:"text-green-600"}),t.jsx(l,{title:`Revenue (${J} days)`,value:`$${(null==p?void 0:p.periodRevenue.toLocaleString())||0}`,change:void 0!==(null==p?void 0:p.revenueChange)?{value:Math.abs(p.revenueChange),type:p.revenueChange>=0?"increase":"decrease",period:"vs previous period"}:void 0,icon:n.Revenue,iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),t.jsx(l,{title:"Success Rate",value:`${(null==p?void 0:p.successRate)||0}%`,icon:t.jsx(c,{}),iconBgColor:"bg-purple-100",iconColor:"text-purple-600"}),t.jsx(l,{title:"Avg. Order Value",value:`$${(null==p?void 0:p.averageOrderValue.toFixed(2))||0}`,icon:n.Revenue,iconBgColor:"bg-orange-100",iconColor:"text-orange-600"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsx(l,{title:"Total Transactions",value:(null==p?void 0:p.totalTransactions)||0,icon:n.Enrollments,iconBgColor:"bg-gray-100",iconColor:"text-gray-600"}),t.jsx(l,{title:"Refunded",value:`$${(null==p?void 0:p.refundedAmount.toLocaleString())||0} (${(null==p?void 0:p.refundedCount)||0})`,icon:t.jsx(o,{}),iconBgColor:"bg-red-100",iconColor:"text-red-600"}),t.jsx(l,{title:"Failed Transactions",value:(null==p?void 0:p.failedCount)||0,icon:n.Enrollments,iconBgColor:"bg-yellow-100",iconColor:"text-yellow-600"})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Revenue Trend"}),t.jsx(h,{data:v,loading:j})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment Transactions"}),t.jsx("div",{className:"mb-4",children:t.jsx(i,{searchPlaceholder:"Search by email, name, course, or transaction ID...",filters:[{key:"status",label:"Status",type:"select",options:[{label:"Completed",value:"completed"},{label:"Pending",value:"pending"},{label:"Failed",value:"failed"},{label:"Refunded",value:"refunded"}]},{key:"dateRange",label:"Date Range",type:"date-range"},{key:"amountRange",label:"Amount Range",type:"number-range"}],onSearch:e=>{T(e),B(1)},onFilter:e=>{U(e),B(1)},searchValue:P,filterValues:F})}),t.jsx(s,{data:y,columns:ee,loading:C,pagination:te,onRowClick:e=>{I(e),W(!0)},emptyMessage:"No payment transactions found"})]})]})}),O&&t.jsx(g,{payment:z,onClose:()=>{W(!1),I(null)},onRefund:()=>{W(!1),_(!0)}}),V&&t.jsx(u,{payment:z,onClose:()=>{_(!1),I(null)},onConfirm:async e=>{if(z){q(!0);try{const t=G(),a=await fetch(`/api/admin/financial/payments/${z.id}/refund`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({reason:e})});if(!a.ok){const e=await a.json();throw new Error(e.error||"Failed to process refund")}await Promise.all([X(),Y()]),_(!1),I(null)}catch(t){alert(t.message)}finally{q(!1)}}},loading:H})]})}},Symbol.toStringTag,{value:"Module"})),x=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),y=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),b=()=>t.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),v=({status:e})=>t.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${{healthy:"bg-green-100 text-green-800",degraded:"bg-yellow-100 text-yellow-800",down:"bg-red-100 text-red-800"}[e]}`,children:e.charAt(0).toUpperCase()+e.slice(1)}),f=({data:e,label:a})=>{const r=Math.max(...e,1);return t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm text-gray-600",children:a}),t.jsx("div",{className:"flex items-end h-24 gap-1",children:e.map((e,a)=>t.jsx("div",{className:"flex-1 bg-blue-500 rounded-t hover:bg-blue-600 transition-colors",style:{height:e/r*100+"%",minHeight:e>0?"4px":"0"},title:`${e}`},a))})]})},N=({percentage:e,size:a=80,strokeWidth:r=8})=>{const l=(a-r)/2,n=2*l*Math.PI,i=n-e/100*n;return t.jsxs("div",{className:"relative",style:{width:a,height:a},children:[t.jsxs("svg",{className:"transform -rotate-90",width:a,height:a,children:[t.jsx("circle",{className:"text-gray-200",strokeWidth:r,stroke:"currentColor",fill:"transparent",r:l,cx:a/2,cy:a/2}),t.jsx("circle",{className:"text-blue-600",strokeWidth:r,strokeDasharray:n,strokeDashoffset:i,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:l,cx:a/2,cy:a/2})]}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-lg font-semibold",children:[e,"%"]})})]})},w=({onClose:a,onExport:r,loading:l})=>{const[n,i]=e.useState("csv"),[s,o]=e.useState(["kpis","engagement","courses"]),[c,d]=e.useState(""),[m,h]=e.useState("");return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Export Analytics"}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),t.jsx("div",{className:"flex gap-3",children:["csv","json","pdf"].map(e=>t.jsx("button",{onClick:()=>i(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(n===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e.toUpperCase()},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Include Metrics"}),t.jsx("div",{className:"space-y-2",children:[{id:"kpis",label:"Key Performance Indicators"},{id:"engagement",label:"User Engagement Metrics"},{id:"courses",label:"Course Performance"},{id:"system",label:"System Health"}].map(e=>t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:s.includes(e.id),onChange:()=>{return t=e.id,void o(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:e.label})]},e.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range (Optional)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsx("input",{type:"date",value:c,onChange:e=>d(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("input",{type:"date",value:m,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[t.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:l,children:"Cancel"}),t.jsx("button",{onClick:()=>{r({format:n,metrics:s,dateRange:{start:c,end:m}})},className:"px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:l||0===s.length,children:l?"Exporting...":"Export"})]})]})})},C=({courses:e,loading:a})=>a?t.jsx("div",{className:"animate-pulse space-y-3",children:[1,2,3].map(e=>t.jsx("div",{className:"h-12 bg-gray-200 rounded"},e))}):0===e.length?t.jsx("div",{className:"text-center py-8 text-gray-500",children:"No course data available"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Course"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Enrollments"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Completion"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rating"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.title})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm text-gray-500",children:e.enrollments}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:t.jsxs("div",{className:"flex items-center justify-end",children:[t.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2 mr-2",children:t.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${e.completionRate}%`}})}),t.jsxs("span",{className:"text-sm text-gray-500",children:[e.completionRate,"%"]})]})}),t.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right",children:t.jsxs("div",{className:"flex items-center justify-end",children:[t.jsx(b,{}),t.jsx("span",{className:"ml-1 text-sm text-gray-500",children:e.averageRating.toFixed(1)})]})}),t.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:["$",e.revenue.toLocaleString()]})]},e.courseId))})]})}),k=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[i,s]=e.useState(null),[o,c]=e.useState(null),[d,m]=e.useState([]),[h,u]=e.useState(null),[g,p]=e.useState(!0),[b,k]=e.useState(null),[j,$]=e.useState(30),[R,D]=e.useState(!1),[A,B]=e.useState(!1),[S,L]=e.useState(!1),M=()=>localStorage.getItem("adminToken"),E=e.useCallback(async()=>{try{const e=M(),t=await fetch(`/api/admin/analytics/kpis?period=${j}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch KPIs");const a=await t.json();s(a)}catch(e){s({activeUsers:1250,activeUsersChange:12.5,totalEnrollments:3420,enrollmentsChange:8.3,courseCompletions:892,completionsChange:15.2,totalRevenue:125e3,revenueChange:22.1,averageRating:4.6,newUsersThisPeriod:156,period:j})}},[j]),P=e.useCallback(async()=>{try{const e=M(),t=await fetch(`/api/admin/analytics/engagement?period=${j}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch engagement");const a=await t.json();c(a)}catch(e){c({dailyActiveUsers:[120,145,132,168,155,142,178],weeklyActiveUsers:[850,920,880,950],averageSessionDuration:24.5,loginFrequency:3.2,featureUsage:[{feature:"Course Viewing",usage:4520,percentage:85},{feature:"Assignment Submission",usage:1230,percentage:45},{feature:"Discussion Forums",usage:890,percentage:32},{feature:"Portfolio Viewing",usage:650,percentage:24}],userRetention:[{period:"Day 1",rate:85},{period:"Day 7",rate:62},{period:"Day 30",rate:45},{period:"Day 90",rate:32}]})}},[j]),T=e.useCallback(async()=>{try{const e=M(),t=await fetch(`/api/admin/analytics/courses?period=${j}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch course performance");const a=await t.json();m(a.courses||[])}catch(e){m([{courseId:"1",title:"Motion Design Fundamentals",enrollments:450,completionRate:72,averageRating:4.8,revenue:22500,feedbackCount:120},{courseId:"2",title:"Advanced Animation Techniques",enrollments:280,completionRate:58,averageRating:4.6,revenue:19600,feedbackCount:85},{courseId:"3",title:"UI/UX Animation",enrollments:320,completionRate:65,averageRating:4.7,revenue:16e3,feedbackCount:95},{courseId:"4",title:"3D Motion Graphics",enrollments:180,completionRate:45,averageRating:4.5,revenue:12600,feedbackCount:52}])}},[j]),F=e.useCallback(async()=>{try{const e=M(),t=await fetch("/api/admin/analytics/system-health",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch system health");const a=await t.json();u(a)}catch(e){u({serverStatus:"healthy",responseTime:145,errorRate:.12,uptime:99.98,databaseConnections:24,memoryUsage:68,cpuUsage:42,activeRequests:156})}},[]);return e.useEffect(()=>{(async()=>{p(!0),k(null),await Promise.all([E(),P(),T(),F()]),p(!1)})()},[E,P,T,F]),g?t.jsx(a,{title:"Analytics Dashboard",children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):b?t.jsx(a,{title:"Analytics Dashboard",children:t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:["Error: ",b]})}):t.jsxs(a,{title:"Analytics Dashboard",children:[t.jsx(r,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Platform Analytics"}),t.jsx("p",{className:"text-gray-600",children:"Monitor platform performance and user engagement"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("select",{value:j,onChange:e=>$(Number(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:7,children:"Last 7 days"}),t.jsx("option",{value:30,children:"Last 30 days"}),t.jsx("option",{value:90,children:"Last 90 days"}),t.jsx("option",{value:365,children:"Last year"})]}),t.jsxs("button",{onClick:async()=>{L(!0),await Promise.all([E(),P(),T(),F()]),L(!1)},disabled:S,className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:[t.jsx(y,{}),t.jsx("span",{className:"ml-2",children:S?"Refreshing...":"Refresh"})]}),t.jsxs("button",{onClick:()=>D(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(x,{}),t.jsx("span",{className:"ml-2",children:"Export"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(l,{title:"Active Users",value:(null==i?void 0:i.activeUsers.toLocaleString())||"0",change:void 0!==(null==i?void 0:i.activeUsersChange)?{value:Math.abs(i.activeUsersChange),type:i.activeUsersChange>=0?"increase":"decrease",period:"vs previous period"}:void 0,icon:n.Users,iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),t.jsx(l,{title:"Total Enrollments",value:(null==i?void 0:i.totalEnrollments.toLocaleString())||"0",change:void 0!==(null==i?void 0:i.enrollmentsChange)?{value:Math.abs(i.enrollmentsChange),type:i.enrollmentsChange>=0?"increase":"decrease",period:"vs previous period"}:void 0,icon:n.Enrollments,iconBgColor:"bg-green-100",iconColor:"text-green-600"}),t.jsx(l,{title:"Course Completions",value:(null==i?void 0:i.courseCompletions.toLocaleString())||"0",change:void 0!==(null==i?void 0:i.completionsChange)?{value:Math.abs(i.completionsChange),type:i.completionsChange>=0?"increase":"decrease",period:"vs previous period"}:void 0,icon:n.Courses,iconBgColor:"bg-purple-100",iconColor:"text-purple-600"}),t.jsx(l,{title:"Total Revenue",value:`$${(null==i?void 0:i.totalRevenue.toLocaleString())||"0"}`,change:void 0!==(null==i?void 0:i.revenueChange)?{value:Math.abs(i.revenueChange),type:i.revenueChange>=0?"increase":"decrease",period:"vs previous period"}:void 0,icon:n.Revenue,iconBgColor:"bg-orange-100",iconColor:"text-orange-600"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"User Activity"}),o&&t.jsxs("div",{className:"space-y-6",children:[t.jsx(f,{data:o.dailyActiveUsers,label:"Daily Active Users (Last 7 days)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Avg. Session Duration"}),t.jsxs("p",{className:"text-2xl font-semibold",children:[o.averageSessionDuration," min"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Login Frequency"}),t.jsxs("p",{className:"text-2xl font-semibold",children:[o.loginFrequency,"x/week"]})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Feature Usage"}),o&&t.jsx("div",{className:"space-y-4",children:o.featureUsage.map(e=>t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{className:"text-gray-700",children:e.feature}),t.jsxs("span",{className:"text-gray-500",children:[e.usage.toLocaleString()," uses"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${e.percentage}%`}})})]},e.feature))})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"User Retention"}),o&&t.jsx("div",{className:"flex justify-around items-center",children:o.userRetention.map(e=>t.jsxs("div",{className:"text-center",children:[t.jsx(N,{percentage:e.rate}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:e.period})]},e.period))})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Course Performance"}),t.jsx(C,{courses:d,loading:!1})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),h&&t.jsx(v,{status:h.serverStatus})]}),h&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Response Time"}),t.jsxs("p",{className:"text-2xl font-semibold",children:[h.responseTime,"ms"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Error Rate"}),t.jsxs("p",{className:"text-2xl font-semibold",children:[h.errorRate,"%"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Uptime"}),t.jsxs("p",{className:"text-2xl font-semibold",children:[h.uptime,"%"]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Active Requests"}),t.jsx("p",{className:"text-2xl font-semibold",children:h.activeRequests})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"Memory Usage"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:t.jsx("div",{className:"h-2 rounded-full "+(h.memoryUsage>80?"bg-red-500":h.memoryUsage>60?"bg-yellow-500":"bg-green-500"),style:{width:`${h.memoryUsage}%`}})}),t.jsxs("span",{className:"text-sm font-medium",children:[h.memoryUsage,"%"]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"CPU Usage"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:t.jsx("div",{className:"h-2 rounded-full "+(h.cpuUsage>80?"bg-red-500":h.cpuUsage>60?"bg-yellow-500":"bg-green-500"),style:{width:`${h.cpuUsage}%`}})}),t.jsxs("span",{className:"text-sm font-medium",children:[h.cpuUsage,"%"]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-500",children:"DB Connections"}),t.jsx("p",{className:"text-2xl font-semibold",children:h.databaseConnections})]})]})]})]})}),R&&t.jsx(w,{onClose:()=>D(!1),onExport:async e=>{B(!0);try{const t=M(),a=new URLSearchParams({format:e.format,metrics:e.metrics.join(",")});e.dateRange.start&&a.append("startDate",e.dateRange.start),e.dateRange.end&&a.append("endDate",e.dateRange.end);const r=await fetch(`/api/admin/analytics/export?${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error("Failed to export analytics");if("csv"===e.format){const e=await r.blob(),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`analytics-report-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}else if("json"===e.format){const e=await r.json(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`analytics-report-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a)}else{const e=await r.json(),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download=`analytics-report-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a)}D(!1)}catch(t){alert(t.message)}finally{B(!1)}},loading:A})]})}},Symbol.toStringTag,{value:"Module"}));export{k as A,p as F};
