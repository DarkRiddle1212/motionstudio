import{r as e,j as t}from"./chunk-CJk5566G.js";import{A as a,F as r,M as i,a as l,S as n,c as s,d as o}from"./chunk-6oSn1JRi.js";import"./chunk-BXbIpaFw.js";import{D as c}from"./chunk-B2YaEX5v.js";const d=()=>t.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),m=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),u=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),h=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),g=()=>t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),p=()=>t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),b=()=>t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),y=()=>t.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),f=()=>t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),v=({enabled:e,onChange:a,disabled:r=!1})=>t.jsx("button",{type:"button",onClick:()=>!r&&a(!e),disabled:r,className:`relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${e?"bg-blue-600":"bg-gray-200"} ${r?"opacity-50 cursor-not-allowed":""}`,children:t.jsx("span",{className:"pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out "+(e?"translate-x-5":"translate-x-0")})}),x=({config:a,onClose:r,onSave:i,loading:l})=>{const[n,s]=e.useState((null==a?void 0:a.category)||"general"),[o,c]=e.useState((null==a?void 0:a.key)||""),[d,m]=e.useState(void 0!==(null==a?void 0:a.value)?JSON.stringify(a.value,null,2):""),[u,h]=e.useState((null==a?void 0:a.description)||""),[g,p]=e.useState("");return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"Edit Configuration":"Add Configuration"}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault();try{const e=JSON.parse(d);p(""),i({category:n,key:o,value:e,description:u})}catch{p("Invalid JSON value")}},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),t.jsxs("select",{value:n,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"general",children:"General"}),t.jsx("option",{value:"email",children:"Email"}),t.jsx("option",{value:"payment",children:"Payment"}),t.jsx("option",{value:"features",children:"Features"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key"}),t.jsx("input",{type:"text",value:o,onChange:e=>c(e.target.value),disabled:!!a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"config_key",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Value (JSON)"}),t.jsx("textarea",{value:d,onChange:e=>m(e.target.value),rows:4,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm "+(g?"border-red-500":"border-gray-300"),placeholder:'{"key": "value"}',required:!0}),g&&t.jsx("p",{className:"mt-1 text-sm text-red-500",children:g})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),t.jsx("input",{type:"text",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Configuration description",required:!0})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:l,children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:l,children:l?"Saving...":"Save"})]})]})]})})},N=({template:a,onClose:r,onSave:i,loading:l})=>{var n;const[s,o]=e.useState((null==a?void 0:a.name)||""),[c,d]=e.useState((null==a?void 0:a.subject)||""),[m,u]=e.useState((null==a?void 0:a.htmlContent)||""),[h,g]=e.useState((null==a?void 0:a.textContent)||""),[p,b]=e.useState((null==(n=null==a?void 0:a.variables)?void 0:n.join(", "))||""),[f,x]=e.useState((null==a?void 0:a.category)||"notification"),[N,w]=e.useState((null==a?void 0:a.isActive)??!0),[k,C]=e.useState(!1);return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 my-8 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"Edit Email Template":"Create Email Template"}),t.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),i({name:s,subject:c,htmlContent:m,textContent:h,variables:p.split(",").map(e=>e.trim()).filter(Boolean),category:f,isActive:N})},className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template Name"}),t.jsx("input",{type:"text",value:s,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"welcome_email",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),t.jsxs("select",{value:f,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"auth",children:"Authentication"}),t.jsx("option",{value:"course",children:"Course"}),t.jsx("option",{value:"payment",children:"Payment"}),t.jsx("option",{value:"notification",children:"Notification"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject"}),t.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Welcome to Motion Studio, {{firstName}}!",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Variables (comma-separated)"}),t.jsx("input",{type:"text",value:p,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"firstName, lastName, email, courseName"}),t.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Use ","{{variableName}}"," in your content"]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HTML Content"}),t.jsx("textarea",{value:m,onChange:e=>u(e.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"<html><body><h1>Hello {{firstName}}</h1></body></html>",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plain Text Content"}),t.jsx("textarea",{value:h,onChange:e=>g(e.target.value),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm",placeholder:"Hello {{firstName}},\\n\\nWelcome to Motion Studio!",required:!0})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx(v,{enabled:N,onChange:w}),t.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]}),t.jsxs("button",{type:"button",onClick:()=>C(!k),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[t.jsx(y,{}),k?"Hide Preview":"Show Preview"]})]}),k&&t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"HTML Preview"}),t.jsx("div",{className:"bg-white border border-gray-200 rounded p-4 max-h-48 overflow-auto",dangerouslySetInnerHTML:{t:m}})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[t.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",disabled:l,children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",disabled:l,children:l?"Saving...":"Save Template"})]})]})]})})},w=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[i,l]=e.useState("general"),[n,s]=e.useState([]),[o,c]=e.useState([]),[y,w]=e.useState([]),[k,C]=e.useState([]),[S,A]=e.useState(!0),[L,j]=e.useState(!1),[E,T]=e.useState(null),[M,_]=e.useState(!1),[$,D]=e.useState(!1),[P,F]=e.useState(null),[B,z]=e.useState(null),O=()=>localStorage.getItem("adminToken"),R=e.useCallback(async()=>{try{const e=O(),t=await fetch("/api/admin/settings/configs",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch configurations");const a=await t.json();s(a.configs||[])}catch(e){s([{id:"1",category:"general",key:"site_name",value:"Motion Studio",description:"Platform name",updatedBy:null,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"2",category:"general",key:"support_email",value:"support@motionstudio.com",description:"Support email address",updatedBy:null,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"3",category:"payment",key:"stripe_enabled",value:!0,description:"Enable Stripe payments",updatedBy:null,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}])}},[]),W=e.useCallback(async()=>{try{const e=O(),t=await fetch("/api/admin/settings/features",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch features");const a=await t.json();c(a.features||[])}catch(e){c([{key:"feature_course_reviews",enabled:!0,description:"Allow students to leave course reviews"},{key:"feature_discussion_forums",enabled:!0,description:"Enable discussion forums on courses"},{key:"feature_certificates",enabled:!1,description:"Generate completion certificates"},{key:"feature_live_sessions",enabled:!1,description:"Enable live video sessions"},{key:"feature_portfolio_public",enabled:!0,description:"Make portfolio publicly accessible"}])}},[]),H=e.useCallback(async()=>{try{const e=O(),t=await fetch("/api/admin/settings/email-templates",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch templates");const a=await t.json();w(a.templates||[])}catch(e){w([{id:"1",name:"welcome_email",subject:"Welcome to Motion Studio!",htmlContent:"<h1>Welcome!</h1>",textContent:"Welcome!",variables:["firstName","email"],category:"auth",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"2",name:"course_enrollment",subject:"You're enrolled in {{courseName}}",htmlContent:"<h1>Enrollment Confirmed</h1>",textContent:"Enrollment Confirmed",variables:["firstName","courseName"],category:"course",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"3",name:"payment_receipt",subject:"Payment Receipt - {{amount}}",htmlContent:"<h1>Payment Receipt</h1>",textContent:"Payment Receipt",variables:["firstName","amount","courseName"],category:"payment",isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}])}},[]),U=e.useCallback(async()=>{try{const e=O(),t=await fetch("/api/admin/settings/backups?limit=50",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch backups");const a=await t.json();C(a.backups||[])}catch(e){C([])}},[]);e.useEffect(()=>{(async()=>{A(!0),T(null),await Promise.all([R(),W(),H(),U()]),A(!1)})()},[R,W,H,U]);const J=[{id:"general",label:"General Settings",icon:d},{id:"email",label:"Email Templates",icon:m},{id:"features",label:"Feature Toggles",icon:u},{id:"backups",label:"Change History",icon:h}];return S?t.jsx(a,{title:"System Settings",children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}):t.jsx(a,{title:"System Settings",children:t.jsxs(r,{children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"System Configuration"}),t.jsx("p",{className:"text-gray-600",children:"Manage platform settings, email templates, and feature toggles"})]}),t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"flex space-x-8",children:J.map(e=>t.jsxs("button",{onClick:()=>l(e.id),className:"flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors "+(i===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[t.jsx(e.icon,{}),e.label]},e.id))})}),"general"===i&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Configurations"}),t.jsxs("button",{onClick:()=>{F(null),_(!0)},className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(g,{}),t.jsx("span",{className:"ml-2",children:"Add Configuration"})]})]}),t.jsx("div",{className:"divide-y divide-gray-200",children:0===n.length?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No configurations found"}):n.map(e=>t.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-mono text-sm font-medium text-gray-900",children:e.key}),t.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:e.category})]}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.description}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1 font-mono",children:["Value: ","object"==typeof e.value?JSON.stringify(e.value):String(e.value)]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{F(e),_(!0)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:t.jsx(p,{})}),t.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this configuration?"))try{const t=O();if(!(await fetch(`/api/admin/settings/configs/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to delete configuration");await R()}catch(t){alert(t.message)}})(e.key),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:t.jsx(b,{})})]})]},e.id))})]}),"email"===i&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Templates"}),t.jsxs("button",{onClick:()=>{z(null),D(!0)},className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(g,{}),t.jsx("span",{className:"ml-2",children:"Add Template"})]})]}),t.jsx("div",{className:"divide-y divide-gray-200",children:0===y.length?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No email templates found"}):y.map(e=>t.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.name}),t.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:e.category}),t.jsx("span",{className:"px-2 py-0.5 text-xs rounded "+(e.isActive?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.isActive?"Active":"Inactive"})]}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.subject}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Variables: ",e.variables.length>0?e.variables.join(", "):"None"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{z(e),D(!0)},className:"p-2 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit",children:t.jsx(p,{})}),t.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this template?"))try{const t=O();if(!(await fetch(`/api/admin/settings/email-templates/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to delete template");await H()}catch(t){alert(t.message)}})(e.id),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",title:"Delete",children:t.jsx(b,{})})]})]},e.id))})]}),"features"===i&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Feature Toggles"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Enable or disable platform features instantly"})]}),t.jsx("div",{className:"divide-y divide-gray-200",children:0===o.length?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No feature toggles configured"}):o.map(e=>t.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("span",{className:"font-medium text-gray-900",children:e.key.replace("feature_","").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.description})]}),t.jsx(v,{enabled:e.enabled,onChange:t=>(async(e,t)=>{try{const a=O();if(!(await fetch(`/api/admin/settings/features/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({enabled:t})})).ok)throw new Error("Failed to toggle feature");c(a=>a.map(a=>a.key===e?{...a,enabled:t}:a))}catch(a){alert(a.message),c(a=>a.map(a=>a.key===e?{...a,enabled:!t}:a))}})(e.key,t)})]},e.key))})]}),"backups"===i&&t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configuration Change History"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"View and rollback configuration changes"})]}),t.jsx("div",{className:"divide-y divide-gray-200",children:0===k.length?t.jsx("div",{className:"p-8 text-center text-gray-500",children:"No configuration changes recorded"}):k.map(e=>t.jsx("div",{className:"p-4 hover:bg-gray-50",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-mono text-sm font-medium text-gray-900",children:e.configKey}),t.jsx("span",{className:"text-xs text-gray-400",children:new Date(e.createdAt).toLocaleString()})]}),t.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Previous:"}),t.jsx("span",{className:"ml-2 font-mono text-red-600",children:"object"==typeof e.previousValue?JSON.stringify(e.previousValue):String(e.previousValue)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"New:"}),t.jsx("span",{className:"ml-2 font-mono text-green-600",children:"object"==typeof e.newValue?JSON.stringify(e.newValue):String(e.newValue)})]})]})]}),t.jsxs("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to rollback to this configuration?"))try{const t=O();if(!(await fetch(`/api/admin/settings/backups/${e}/rollback`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to rollback configuration");await R(),await U()}catch(t){alert(t.message)}})(e.id),className:"inline-flex items-center px-3 py-1.5 text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors",title:"Rollback to this version",children:[t.jsx(f,{}),t.jsx("span",{className:"ml-1",children:"Rollback"})]})]})},e.id))})]})]}),M&&t.jsx(x,{config:P,onClose:()=>{_(!1),F(null)},onSave:async e=>{j(!0);try{const t=O();if(!(await fetch("/api/admin/settings/configs",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).ok)throw new Error("Failed to save configuration");await R(),await U(),_(!1),F(null)}catch(t){alert(t.message)}finally{j(!1)}},loading:L}),$&&t.jsx(N,{template:B,onClose:()=>{D(!1),z(null)},onSave:async e=>{j(!0);try{const t=O(),a=B?`/api/admin/settings/email-templates/${B.id}`:"/api/admin/settings/email-templates",r=B?"PUT":"POST";if(!(await fetch(a,{method:r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)})).ok)throw new Error("Failed to save template");await H(),D(!1),z(null)}catch(t){alert(t.message)}finally{j(!1)}},loading:L})]})})}},Symbol.toStringTag,{value:"Module"})),k="http://localhost:5000/api",C=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[r,d]=e.useState("overview"),[m,u]=e.useState(null),[h,g]=e.useState([]),[p,b]=e.useState([]),[y,f]=e.useState([]),[v,x]=e.useState(!0),[N,w]=e.useState(null),[C,S]=e.useState(1),[A,L]=e.useState(0),[j,E]=e.useState(1),[T,M]=e.useState(0),[_,$]=e.useState({}),[D,P]=e.useState({}),[F,B]=e.useState(""),[z,O]=e.useState(null),[R,W]=e.useState(!1),[H,U]=e.useState(!1),[J,I]=e.useState(null),[q,V]=e.useState(""),[G,K]=e.useState(!1),Y=e.useCallback(()=>({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("adminToken")||localStorage.getItem("token")}`}),[]),Q=e.useCallback(async()=>{try{const e=await fetch(`${k}/api/admin/security/stats?period=7`,{headers:Y()});if(!e.ok)throw new Error("Failed to fetch security stats");const t=await e.json();u(t)}catch(e){w(e.message)}},[Y]),X=e.useCallback(async()=>{try{const e=new URLSearchParams({page:C.toString(),pageSize:"20",..._}),t=await fetch(`${k}/api/admin/security/events?${e}`,{headers:Y()});if(!t.ok)throw new Error("Failed to fetch security events");const a=await t.json();g(a.events),L(a.total)}catch(e){w(e.message)}},[Y,C,_]),Z=e.useCallback(async()=>{try{const e=new URLSearchParams({page:j.toString(),pageSize:"20",search:F,...D}),t=await fetch(`${k}/api/admin/security/audit-logs?${e}`,{headers:Y()});if(!t.ok)throw new Error("Failed to fetch audit logs");const a=await t.json();b(a.logs),M(a.pagination.totalItems)}catch(e){w(e.message)}},[Y,j,D,F]),ee=e.useCallback(async()=>{try{const e=await fetch(`${k}/api/admin/security/sessions`,{headers:Y()});if(!e.ok)throw new Error("Failed to fetch active sessions");const t=await e.json();f(t.sessions)}catch(e){w(e.message)}},[Y]);e.useEffect(()=>{(async()=>{x(!0);try{await Promise.all([Q(),"events"===r&&X(),"audit"===r&&Z(),"sessions"===r&&ee()].filter(Boolean))}finally{x(!1)}})()},[r,Q,X,Z,ee]);const te=[{id:"timestamp",header:"Time",accessor:"timestamp",render:(e,t)=>new Date(t.timestamp).toLocaleString()},{id:"type",header:"Event Type",accessor:"type",render:(e,a)=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(a.type.includes("login")?"bg-blue-100 text-blue-800":a.type.includes("failed")?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:a.type.replace(/_/g," ").toUpperCase()})},{id:"severity",header:"Severity",accessor:"severity",render:(e,a)=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("critical"===a.severity?"bg-red-100 text-red-800":"high"===a.severity?"bg-orange-100 text-orange-800":"medium"===a.severity?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:a.severity.toUpperCase()})},{id:"ipAddress",header:"IP Address",accessor:"ipAddress"},{id:"userAgent",header:"User Agent",accessor:"userAgent",render:(e,a)=>t.jsx("span",{className:"truncate max-w-xs",title:a.userAgent,children:a.userAgent})}],ae=[{id:"timestamp",header:"Time",accessor:"timestamp",render:(e,t)=>new Date(t.timestamp).toLocaleString()},{id:"action",header:"Action",accessor:"action",render:(e,a)=>t.jsx("span",{className:"font-medium text-gray-900",children:a.action.replace(/_/g," ").toUpperCase()})},{id:"resourceType",header:"Resource",accessor:"resourceType",render:(e,a)=>t.jsxs("span",{className:"text-sm text-gray-600",children:[a.resourceType," (",a.resourceId,")"]})},{id:"ipAddress",header:"IP Address",accessor:"ipAddress"},{id:"details",header:"Details",accessor:"id",render:(e,a)=>t.jsx(s,{variant:"secondary",size:"sm",onClick:()=>{O(a),W(!0)},children:"View Details"})}],re=[{id:"user",header:"User",accessor:"email",render:(e,a)=>t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:a.user?`${a.user.firstName} ${a.user.lastName}`:"Unknown"}),t.jsx("div",{className:"text-sm text-gray-500",children:a.email})]})},{id:"loginTime",header:"Login Time",accessor:"loginTime",render:(e,t)=>new Date(t.loginTime).toLocaleString()},{id:"lastActivity",header:"Last Activity",accessor:"lastActivity",render:(e,t)=>new Date(t.lastActivity).toLocaleString()},{id:"ipAddress",header:"IP Address",accessor:"ipAddress"},{id:"actions",header:"Actions",accessor:"id",render:(e,a)=>t.jsx(s,{variant:"secondary",size:"sm",onClick:()=>{I(a),U(!0)},children:"Force Logout"})}];return v?t.jsx(a,{title:"Security Monitoring",breadcrumbs:[{label:"Security Monitoring"}],children:t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):N?t.jsx(a,{title:"Security Monitoring",breadcrumbs:[{label:"Security Monitoring"}],children:t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"text-red-800",children:["Error: ",N]})})}):t.jsx(a,{title:"Security Monitoring",breadcrumbs:[{label:"Security Monitoring"}],children:t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"border-b border-gray-200",children:t.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Overview"},{id:"events",label:"Security Events"},{id:"audit",label:"Audit Logs"},{id:"sessions",label:"Active Sessions"}].map(e=>t.jsx("button",{onClick:()=>d(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm "+(r===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"overview"===r&&m&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(i,{title:"Total Events",value:m.totalEvents,icon:l.Activity}),t.jsx(i,{title:"Login Attempts",value:m.loginAttempts,icon:l.Users}),t.jsx(i,{title:"Failed Logins",value:m.failedLogins,icon:l.Warning}),t.jsx(i,{title:"Critical Events",value:m.criticalEvents,icon:l.Alert})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Security Events (Last 7 Days)"}),t.jsx("div",{className:"h-64 flex items-end space-x-2",children:m.dailyEvents.map((e,a)=>t.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[t.jsx("div",{className:"bg-blue-500 w-full rounded-t",style:{height:`${Math.max(e.count/Math.max(...m.dailyEvents.map(e=>e.count))*200,4)}px`}}),t.jsx("div",{className:"text-xs text-gray-500 mt-2",children:new Date(e.date).toLocaleDateString("en-US",{weekday:"short"})})]},a))})]})]}),"events"===r&&t.jsxs("div",{className:"space-y-6",children:[t.jsx(n,{searchPlaceholder:"Search security events...",filters:[{key:"type",label:"Event Type",type:"select",options:[{label:"All Types",value:""},{label:"Login Attempt",value:"login_attempt"},{label:"Failed Login",value:"failed_login"},{label:"Suspicious Activity",value:"suspicious_activity"},{label:"Permission Escalation",value:"permission_escalation"}]},{key:"severity",label:"Severity",type:"select",options:[{label:"All Severities",value:""},{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"}]},{key:"dateRange",label:"Date Range",type:"date-range"}],onSearch:e=>B(e),onFilter:e=>$(e)}),t.jsx(c,{data:h,columns:te,loading:v,pagination:{page:C,pageSize:20,totalItems:A,onPageChange:S}})]}),"audit"===r&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(n,{searchPlaceholder:"Search audit logs...",filters:[{key:"action",label:"Action Type",type:"select",options:[{label:"All Actions",value:""},{label:"User Management",value:"user_"},{label:"Course Management",value:"course_"},{label:"Payment Management",value:"payment_"},{label:"System Configuration",value:"config_"}]},{key:"resourceType",label:"Resource Type",type:"select",options:[{label:"All Resources",value:""},{label:"User",value:"user"},{label:"Course",value:"course"},{label:"Payment",value:"payment"},{label:"System Config",value:"system_config"}]},{key:"dateRange",label:"Date Range",type:"date-range"}],onSearch:e=>B(e),onFilter:e=>P(e)}),t.jsx(s,{onClick:async()=>{K(!0);try{const e=new URLSearchParams({format:"csv",...D}),t=await fetch(`${k}/api/admin/security/audit-logs/export?${e}`,{headers:Y()});if(!t.ok)throw new Error("Failed to export audit logs");const a=await t.blob(),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=`audit-logs-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(r),document.body.removeChild(i)}catch(e){w(e.message)}finally{K(!1)}},disabled:G,className:"ml-4",children:G?"Exporting...":"Export Audit Logs"})]}),t.jsx(c,{data:p,columns:ae,loading:v,pagination:{page:j,pageSize:20,totalItems:T,onPageChange:E}})]}),"sessions"===r&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Active Admin Sessions"}),t.jsx(s,{onClick:ee,variant:"secondary",children:"Refresh Sessions"})]}),t.jsx(c,{data:y,columns:re,loading:v})]}),t.jsx(o,{isOpen:R,onClose:()=>W(!1),title:"Audit Log Details",children:z&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Action"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:z.action})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Timestamp"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(z.timestamp).toLocaleString()})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Resource Type"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:z.resourceType})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Resource ID"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:z.resourceId})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"IP Address"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:z.ipAddress})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"User Agent"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900 break-all",children:z.userAgent})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Changes"}),t.jsx("pre",{className:"mt-1 text-sm text-gray-900 bg-gray-50 p-3 rounded border overflow-auto max-h-64",children:JSON.stringify(z.changes,null,2)})]})]})}),t.jsx(o,{isOpen:H,onClose:()=>U(!1),title:"Force Logout Session",children:J&&t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:t.jsxs("div",{className:"text-yellow-800",children:[t.jsx("strong",{children:"Warning:"})," This will immediately terminate the user's session."]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"User"}),t.jsx("p",{className:"mt-1 text-sm text-gray-900",children:J.user?`${J.user.firstName} ${J.user.lastName} (${J.email})`:J.email})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Reason for Force Logout"}),t.jsx("textarea",{value:q,onChange:e=>V(e.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Enter reason for forcing logout...",required:!0})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx(s,{variant:"secondary",onClick:()=>U(!1),children:"Cancel"}),t.jsx(s,{onClick:async()=>{if(J)try{if(!(await fetch(`${k}/api/admin/security/sessions/${J.sessionId}/force-logout`,{method:"POST",headers:Y(),body:JSON.stringify({reason:q})})).ok)throw new Error("Failed to force logout");U(!1),I(null),V(""),ee()}catch(e){w(e.message)}},disabled:!q.trim(),className:"bg-red-600 hover:bg-red-700",children:"Force Logout"})]})]})})]})})}},Symbol.toStringTag,{value:"Module"}));export{w as S,C as a};
